<div id='more_options_field'>
  <p>
    <%= link_to t('.advanced_options'), "#",
                :id => 'toggle_advanced_options',
                :title => t('.toggle_advanced_options') %>
  </p>
  <span id='draft_field'>
    <%= f.check_box :draft %>
    <%= f.label :draft, t('.save_as_draft'),
                :class => "stripped" %>
  </span>
</div>
<div id='more_options' style="display:none;">
  <div class="hemisquare">
    <h2><%= t('.page_options') %></h2>
    <div class='field'>
      <span class='label_with_help'>
        <%= f.label :parent_id, t('.parent_page') %>
        <%= refinery_help_tag t('.parent_page_help') %>
      </span>
      <%#= f.select :parent_id, parent_id_nested_set_options(@page), :include_blank => true %>
      <% if f.object.new_record? || f.object.parent_id.blank? %>
        <div>
          <span class="deep-title">Depth 0：</span>
          <%= select_tag :parent_id, options_from_collection_for_select(Refinery::Page.select(:id).where(:depth => 0), :id, :title), :include_blank => true, :class => "parent-id-selector", :id => "depth-0", :data => {:depth => 0} %>
        </div>
      <% else %>
        <% parent_id = f.object.parent_id %>
        <% parent_pages = [] %>
        <% i = 0 %>
        <% while(i < 10) %>
          <% parent_pages[i] = (i == 0) ? Refinery::Page.select("id, parent_id").find(parent_id) : Refinery::Page.select("id, parent_id").find(parent_pages[i-1].parent_id) rescue nil %>
          <% parent_pages[i].present? ? i += 1 : break %>
        <% end %>

        <% parent_pages.compact.reverse.each_with_index do |parent_page, i| %>
          <div>
            <span class="deep-title">Depth <%= i %>：</span>
            <% if i == 0 %>
              <% select_options = options_from_collection_for_select(Refinery::Page.select(:id).where(:depth => 0), :id, :title, parent_page.id) %>
            <% else %>
              <% select_options = options_from_collection_for_select(Refinery::Page.select(:id).where(:parent_id => parent_page.parent_id), :id, :title, parent_page.id) %>
            <% end %>
            <%= select_tag :parent_id, select_options, :include_blank => true, :class => "parent-id-selector", :id => "depth-#{i}", :data => {:depth => i} %>
          </div>
        <% end %>
      <% end %>
      <%= refinery_icon_tag("ajax-loader.gif", :style => "display:none", :id => "loading-image") %>
      <%= f.hidden_field :parent_id, :id => "hidden-parent-id" %>
    </div>
    <% if Refinery::Pages.use_layout_templates %>
    <div class='field'>
      <span class='label_with_help'>
        <%= f.label :layout_template, t('.layout_template') %>
        <%= refinery_help_tag t('.layout_template_help') %>
      </span>
      <% if @page.parent_id? %>
        <%= f.select(:layout_template, @valid_layout_templates, {:selected => @page.parent.layout_template}) %>
      <% else %>
        <%= f.select(:layout_template, @valid_layout_templates) %>
      <% end %>
    </div>
    <% end %>
    <% if Refinery::Pages.use_view_templates %>
    <div class='field'>
      <span class='label_with_help'>
        <%= f.label :view_template, t('.view_template') %>
        <%= refinery_help_tag t('.view_template_help') %>
      </span>
      <% if @page.parent_id? %>
        <%= f.select(:view_template, @valid_view_templates.map{|t| [t.titleize, t]}, {:selected => @page.parent.view_template }) %>
      <% else %>
        <%= f.select(:view_template, @valid_view_templates.map{|t| [t.titleize, t]}) %>
      <% end %>
    </div>
    <% end %>

    <div class='field'>
      <span class='label_with_help'>
        <%= f.label :menu_title, t('.menu_title') %>
        <%= refinery_help_tag t('.menu_title_help') %>
      </span>
      <%= f.text_field :menu_title, :style=> 'width:400px;' %>
    </div>
    <% if Refinery::Pages.use_custom_slugs %>
    <div class='field'>
      <span class='label_with_help'>
        <%= f.label :custom_slug, t('.custom_slug') %>
        <%= refinery_help_tag t('.custom_slug_help') %>
      </span>
      <%= f.text_field :custom_slug, :style=> 'width:400px;' %>
    </div>
    <% end %>
    <div class='field'>
      <span class='label_with_help'>
        <%= f.label :skip_to_first_child?, t('.skip_to_first_child') %>
        <%= refinery_help_tag t('.skip_to_first_child_help') %>
      </span>
      <%= f.check_box :skip_to_first_child %>
      <%= f.label :skip_to_first_child, t('.skip_to_first_child_label'),
                  :class => "stripped" %>
    </div>
    <div class='field'>
      <span class='label_with_help'>
        <%= f.label :link_url, t('.link_url') %>
        <%= refinery_help_tag t('.link_url_help') %>
      </span>
      <%= f.text_field :link_url, :style=> 'width:400px;' %>
      <% content_for :javascripts do %>
      <script>
        $(document).ready(function(){
          link_tester.init('<%= refinery.test_url_admin_pages_dialogs_path %>',
                           '<%= refinery.test_email_admin_pages_dialogs_path %>');

          link_tester.validate_url_textbox("#page_link_url")
        });
      </script>
      <% end %>
    </div>
    <div class='field'>
      <span class='label_with_help'>
        <%= f.label :show_in_menu, t('.show_in_menu_title'),
                    :id => 'page_show_in_menu_heading' %>
        <%= refinery_help_tag t('.show_in_menu_help') %>
      </span>
      <%= f.check_box :show_in_menu %>
      <%= f.label :show_in_menu, t('.show_in_menu_description'),
                  :class => "stripped" %>
    </div>
  </div>

  <%= render 'form_advanced_options_seo', :f => f %>
</div>
